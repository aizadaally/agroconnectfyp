<!-- Updated farmer_dashboard.html with Kyrgyz-themed design -->
{% extends 'frontend/base.html' %}
{% load i18n %}
{% load static %}

{% block title %}{% trans "Farmer Dashboard" %} - AgroConnect{% endblock %}

{% block extra_css %}
<style>
    /* Kyrgyz-themed dashboard styles */
    .dashboard-hero {
        background-image: linear-gradient(rgba(40, 167, 69, 0.7), rgba(0, 0, 0, 0.5)), 
                          url('/media/kyrgyz-nature/tian-shan-mountains.jpg');
        background-size: cover;
        background-position: center;
        color: white;
        padding: 80px 0;
        border-radius: 12px;
        margin-bottom: 30px;
        position: relative;
        overflow: hidden;
    }
    
    .dashboard-hero::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('/media/kyrgyz-patterns/yurt-pattern.png') no-repeat bottom right;
        opacity: 0.1;
        background-size: 300px;
    }
    
    .farmer-profile-section {
        background: linear-gradient(to bottom, var(--bg-primary), var(--bg-secondary));
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        position: relative;
    }
    
    .kyrgyz-farmer-image {
        width: 150px;
        height: 150px;
        border-radius: 15px;
        object-fit: cover;
        border: 4px solid var(--bg-success);
        box-shadow: 0 8px 25px var(--shadow-lg);
    }
    
    .stat-card {
        background: var(--bg-primary);
        border: none;
        border-radius: 15px;
        overflow: hidden;
        transition: transform 0.3s, box-shadow 0.3s;
        position: relative;
        background-image: url('/media/kyrgyz-nature/naryn-fields.jpg');
        background-size: cover;
        background-position: center;
    }
    
    .stat-card-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, var(--bg-success), rgba(40, 167, 69, 0.9));
        z-index: 1;
    }
    
    .stat-card-content {
        position: relative;
        z-index: 2;
        color: white;
        padding: 25px;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 30px var(--shadow-lg);
    }
    
    .kyrgyz-pattern-border {
        border-image: repeating-linear-gradient(45deg, 
            var(--bg-success) 0px, 
            var(--bg-success) 10px, 
            transparent 10px, 
            transparent 20px) 1;
        border-bottom: 4px solid;
        padding-bottom: 20px;
        margin-bottom: 30px;
    }
    
    .products-table {
        background: var(--bg-primary);
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 4px 15px var(--shadow);
    }
    
    .table thead {
        background: linear-gradient(45deg, var(--bg-success), #229954);
        color: white;
    }
    
    .farmer-welcome {
        font-family: 'Roboto', sans-serif;
        font-size: 2.2rem;
        font-weight: 700;
        margin-bottom: 15px;
    }
    
    .kyrgyz-quote {
        font-style: italic;
        opacity: 0.9;
        font-size: 1.1rem;
        margin-bottom: 20px;
    }
    
    .naryn-weather {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 10px;
        padding: 15px;
        display: inline-block;
        color: #333;
    }
    
    [data-theme="dark"] .naryn-weather {
        background: rgba(0, 0, 0, 0.8);
        color: #fff;
    }
</style>
{% endblock %}

{% block content %}
<!-- Dashboard Hero Section with Kyrgyz Mountains -->
<div class="dashboard-hero">
    <div class="container text-center">
        <h1 class="farmer-welcome">
            {% trans "Welcome back" %}, {{ user.first_name|default:user.username }}!
        </h1>
        <p class="kyrgyz-quote">
            {% if LANGUAGE_CODE == 'ky' %}
                "Жер - алтын, эмгек - күмүш" - Кыргыз макал
            {% elif LANGUAGE_CODE == 'ru' %}
                "Земля - золото, труд - серебро" - Киргизская пословица
            {% else %}
                "Land is gold, labor is silver" - Kyrgyz proverb
            {% endif %}
        </p>
        
        <!-- Current Naryn Weather -->
        <div class="naryn-weather">
            <i class="bi bi-sun me-2"></i>
            <span>{% trans "Naryn Today:" %} 18°C</span>
            <i class="bi bi-cloud ms-3 me-2"></i>
            <span>{% trans "Partly Cloudy" %}</span>
        </div>
    </div>
</div>

<div class="container py-4">
    <!-- Farmer Profile Section -->
    <div class="farmer-profile-section">
        <div class="row align-items-center">
            <div class="col-md-3 text-center">
                {% if user.profile_image %}
                <img src="{{ user.profile_image.url }}" alt="{{ user.username }}" class="kyrgyz-farmer-image">
                {% else %}
                <!-- Use a default Kyrgyz farmer photo -->
                <img src="/media/farmers/default-kyrgyz-farmer.jpg" alt="Kyrgyz Farmer" class="kyrgyz-farmer-image">
                {% endif %}
            </div>
            <div class="col-md-9">
                <h3 class="mb-2">{{ user.get_full_name|default:user.username }}</h3>
                <p class="text-muted mb-1">
                    <i class="bi bi-geo-alt me-2"></i>{{ user.farm_location|default:"Naryn Oblast" }}
                </p>
                <p class="text-muted mb-3">
                    <i class="bi bi-house me-2"></i>{{ user.farm_name|default:"Family Farm" }}
                </p>
                <div class="d-flex gap-2">
                    <span class="badge bg-success"><i class="bi bi-check-circle me-1"></i>{% trans "Verified Farmer" %}</span>
                    <span class="badge bg-info"><i class="bi bi-award me-1"></i>{% trans "Naryn Region" %}</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Statistics Cards with Kyrgyz Nature Backgrounds -->
    <div class="row mb-5">
        <div class="col-md-3 mb-4">
            <div class="stat-card">
                <div class="stat-card-overlay"></div>
                <div class="stat-card-content text-center">
                    <i class="bi bi-basket fs-2 mb-2"></i>
                    <h4>{{ products|length }}</h4>
                    <p class="mb-0">{% trans "Products Listed" %}</p>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-4">
            <div class="stat-card">
                <div class="stat-card-overlay"></div>
                <div class="stat-card-content text-center">
                    <i class="bi bi-bag-check fs-2 mb-2"></i>
                    <h4>{{ orders|length }}</h4>
                    <p class="mb-0">{% trans "Total Orders" %}</p>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-4">
            <div class="stat-card">
                <div class="stat-card-overlay"></div>
                <div class="stat-card-content text-center">
                    <i class="bi bi-currency-dollar fs-2 mb-2"></i>
                    <h4>{{ total_revenue|default:0|floatformat:2 }} сом</h4>
                    <p class="mb-0">{% trans "Total Revenue" %}</p>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-4">
            <div class="stat-card">
                <div class="stat-card-overlay"></div>
                <div class="stat-card-content text-center">
                    <i class="bi bi-people fs-2 mb-2"></i>
                    <h4>{{ customer_count|default:0 }}</h4>
                    <p class="mb-0">{% trans "Customers" %}</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Products Section with Kyrgyz Pattern Border -->
    <div class="kyrgyz-pattern-border">
        <h3 class="mb-4">
            <i class="bi bi-basket me-2"></i>{% trans "My Products" %}
            <a href="{% url 'frontend:add_product' %}" class="btn btn-success float-end">
                <i class="bi bi-plus-lg me-1"></i>{% trans "Add New Product" %}
            </a>
        </h3>
    </div>
    
    {% if products %}
    <div class="products-table">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>{% trans "Product" %}</th>
                        <th>{% trans "Category" %}</th>
                        <th>{% trans "Price" %}</th>
                        <th>{% trans "Stock" %}</th>
                        <th>{% trans "Status" %}</th>
                        <th>{% trans "Actions" %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in products %}
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                {% if product.image %}
                                <img src="{{ product.image.url }}" alt="{{ product.name }}" 
                                     class="me-3" style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px;">
                                {% endif %}
                                <div>
                                    <strong>{{ product.name }}</strong>
                                    <small class="d-block text-muted">Added {{ product.created_at|date:"M j, Y" }}</small>
                                </div>
                            </div>
                        </td>
                        <td>{{ product.category.name|default:_("None") }}</td>
                        <td><strong>{{ product.price|floatformat:2 }} сом</strong></td>
                        <td>
                            {% if product.quantity_available < 10 %}
                            <span class="badge bg-warning">{{ product.quantity_available }} {{ product.unit }}</span>
                            {% else %}
                            <span class="badge bg-success">{{ product.quantity_available }} {{ product.unit }}</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if product.is_available %}
                            <span class="badge bg-success">{% trans "Available" %}</span>
                            {% else %}
                            <span class="badge bg-danger">{% trans "Unavailable" %}</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="btn-group" role="group">
                                <a href="{% url 'frontend:product_detail' product.id %}" 
                                   class="btn btn-sm btn-outline-primary" title="{% trans 'View' %}">
                                    <i class="bi bi-eye"></i>
                                </a>
                                <a href="{% url 'frontend:edit_product' product.id %}" 
                                   class="btn btn-sm btn-outline-success" title="{% trans 'Edit' %}">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <a href="{% url 'frontend:delete_product' product.id %}" 
                                   class="btn btn-sm btn-outline-danger" title="{% trans 'Delete' %}">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
    <div class="text-center py-5">
        <img src="/media/kyrgyz-nature/empty-field.jpg" alt="Empty Field" class="mb-4" style="max-width: 300px; opacity: 0.5;">
        <h4>{% trans "No products yet" %}</h4>
        <p class="text-muted">{% trans "Start by adding your first product to showcase to buyers in Naryn." %}</p>
        <a href="{% url 'frontend:add_product' %}" class="btn btn-success">
            <i class="bi bi-plus-lg me-1"></i>{% trans "Add Your First Product" %}
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}